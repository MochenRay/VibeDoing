---
node: B1
title: 文档分块策略
status: mastered
mastered_date: 2026-01-31
next_review: 2026-02-03
tag: 门槛概念
error_count: 0
---

# B1. 文档分块策略 🚧

## 核心认知

**分块是 RAG 离线阶段的第一步**，决定了知识库"以什么粒度被检索"。

分块策略 = **怎么切** + **切完后 chunk 里放什么**

### 核心矛盾

> 精度 vs 完整性的权衡：切太大→检索精度下降（噪声多）；切太小→上下文丢失（信息碎片化）

---

## 五种分块策略

| 策略 | 做法 | 适用场景 |
|------|------|---------|
| **固定长度** | 每 N 字切一刀 | 快速原型（几乎不用于生产） |
| **固定长度+重叠** | 每 N 字切，前后重叠 M 字 | 通用默认方案（LangChain 默认） |
| **按段落/章节** | 按文档自然结构切 | 结构化文档（政策法规、手册） |
| **按语义** | 用模型检测语义边界（相邻句子相似度低谷处切割） | 高精度要求（法律/医疗） |
| **递归切分** | 从大到小逐层尝试（章→节→段→句） | 复杂长文档（LangChain RecursiveCharacterTextSplitter） |

---

## 参数调优

### 两个核心参数

| 参数 | 典型范围 | 决策依据 |
|------|---------|---------|
| **chunk_size** | 200-2000 字 | 文档类型决定：短条目200-500，中等篇幅500-1000，长篇幅1000-2000 |
| **chunk_overlap** | chunk_size 的 10%-20% | 按结构切时可不需要；固定长度切时必须有 |

### 三个硬约束

1. Embedding 模型长度上限（超了截断）
2. 大模型上下文窗口（Top-K × chunk_size 不能超）
3. 信息完整性下限（<100字的chunk没意义）

---

## 不同文档类型的实战切法

| 文档类型 | 切分单位 | chunk_size | overlap | 元数据 | 特殊处理 |
|---------|---------|-----------|---------|--------|---------|
| **政策法规** | 条款（相关条合并） | 300-800 | 不需要 | 章节归属、文档版本、发布日期 | 短条款合并，长条款拆分 |
| **操作手册** | 完整流程（一个SOP） | 500-1500 | 超长SOP按阶段分时需要 | SOP编号、步骤概览 | 保持流程完整性，不拆步骤 |
| **FAQ** | 问答对 | 100-500 | 无 | 分类标签 | Q+A必须在同一chunk |
| **历史案例** | 单个案例 | 800-2000 | 超长时按阶段分 | 案例编号 | 保持叙事完整性；可用Parent-Child检索 |

---

## 内容增强（关键新认知）

分块策略不只是"怎么切"，还包括"切完后给 chunk 补充什么信息"：

- **元数据**：章节归属、文档版本、发布日期（结构化信息，不进入向量）
- **适用场景摘要**：给条款补充口语化的适用场景描述（进入向量，提升检索命中率）

```
原始："第二十五条 损坏城市绿化设施的，责令赔偿并处500-5000元罚款。"
增强："第二十五条 损坏城市绿化设施的，责令赔偿并处500-5000元罚款。
      【适用场景：车辆碾压绿化带、施工破坏绿地、人为损毁花木/设施等】"
```

**内容增强（离线）和 Query Rewriting（在线）解决同一类问题，作用在不同阶段，效果叠加。**

---

## 验证效果（产品经理视角）

| 方式 | 做法 |
|------|------|
| 人工抽检 | 随机抽 20-30 个 chunk，看语义是否完整 |
| 检索测试 | 30-50 个典型问题，看 Top-5 命中率 |
| Bad case 分析 | 溯源到 chunk 层，判断是没检索到还是信息不全 |
| A/B 测试 | 不同参数对比命中率和回答质量 |

> 分块策略不是一次性决策，是需要根据 bad case 持续迭代的。

---

## Parent-Child 检索（延伸）

解决"叙事型文档拆分后信息不完整"的问题：
- 小 chunk 用于精准检索
- 命中后返回大 chunk（或同组所有 chunk）给大模型
- 既保证检索精度，又保证上下文完整

---

## 验证中的错误与纠正

| 错误点 | 纠正 |
|--------|------|
| 操作手册按步骤切（粒度太小） | 应以完整SOP为chunk，只有超长时才按阶段分组 |
| 投诉记录想拆分处理过程 | 叙事型文档优先保持完整，1000字以内不切 |
| 进阶题只从检索层分析原因 | 分块策略包括"内容增强"，给chunk补充适用场景可提升检索命中 |

---

## 💡 验证高光

**挑战题（会议纪要分块方案）**：
- 正确选择语义切分策略（无固定结构 → 不能按章节切）
- 提出分块前先用大模型清洗口语化内容（数据处理流程思维）
- 用 Obsidian 双链类比 chunk 间交叉引用关系
- 元数据设计包含"议题摘要"作为内容增强

**元认知自评**：8/10，能在具体场景中选对策略，但完整枚举所有策略的信心不足。

---

## 关联概念

- [[P3. 数据质量对RAG的影响]] - 分块断裂是数据质量问题的一种
- [[A1. RAG流程与架构]] - 分块在离线索引阶段的位置
- [[A2. 向量与Embedding]] - chunk 向量化后的检索原理
