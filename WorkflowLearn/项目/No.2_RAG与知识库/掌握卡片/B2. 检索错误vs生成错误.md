---
node: B2
title: 检索错误vs生成错误
status: mastered
mastered_date: 2026-01-31
next_review: 2026-02-03
tag: 普通概念
error_count: 0
---

# B2. 检索错误 vs 生成错误

## 核心认知

RAG 系统出错时，必须先定位是**哪个环节**的问题，再对症下药。两种错误的优化方向几乎没有交集，诊断错了等于白优化。

| | 检索错误 | 生成错误 |
|---|---|---|
| **发生在** | 向量检索阶段 | 大模型生成阶段 |
| **本质** | 找错了/没找到文档 | 找对了文档但答案有问题 |
| **类比** | 图书馆员拿错了书 | 图书馆员拿对了书但读错了 |

---

## 诊断流程：三步定位法

```
Step 1：复现问题（确认稳定存在）
Step 2：查检索结果 → 检索到的文档和用户意图匹配吗？
  ├─ 不匹配 → 知识库有对应内容吗？
  │    ├─ 有 → 检索错误
  │    └─ 没有 → 数据缺失
  └─ 匹配 → Step 3
Step 3：对比文档和回答 → 回答准确反映文档内容吗？
  ├─ 否 → 生成错误
  └─ 是但用户不满意 → 非系统问题/数据质量问题
```

**关键认知**："系统给了答案"≠"检索正确"。给了一个方向错误的答案，往往说明检索到了相关但不对口的文档。

---

## 检索错误的表现与根因

| 表现 | 根因 |
|------|------|
| 完全没找到（"未找到相关信息"） | 文档缺失/Embedding理解不够/Query与文档表述差异大 |
| 找到但不相关（答非所问） | 分块策略不合理/语义相近但意图不匹配 |
| 找到但不完整（回答残缺） | 分块断裂 |

### 优化手段

| 手段 | 阶段 |
|------|------|
| 优化分块策略/内容增强 | 离线 |
| 换更好的 Embedding 模型 | 离线 |
| 混合检索（向量+关键词） | 在线 |
| Query Rewriting | 在线 |
| 调整 Top-K | 在线 |

---

## 生成错误的表现与根因

| 表现 | 根因 |
|------|------|
| 理解错误（数字/条件偏差） | Prompt不清晰/模型能力不足 |
| 遗漏关键信息 | 上下文拼接方式有问题 |
| 格式/表达不符预期 | Prompt未约束输出格式 |
| 编造内容（幻觉） | 模型未被约束"基于文档回答" |

### 优化手段

| 手段 | 阶段 |
|------|------|
| 优化 System Prompt | Prompt层 |
| 强制引用来源 | Prompt层 |
| 调整上下文拼接方式 | Prompt层 |
| 换更强的大模型 | 模型层 |
| 后处理校验 | 输出层 |

---

## 产品设计：内置诊断能力

| 功能 | 覆盖错误类型 | 产品优先级 |
|------|------------|-----------|
| **引用高亮**（回答标注来源） | 两种都覆盖（统一入口） | 最高 |
| **检索结果透出**（展示参考文档） | 检索错误 | 高 |
| **置信度展示** | 检索错误 | 中 |
| **反馈按钮**（👍👎 + 分类） | 规模化采集 | 高 |
| **后台诊断面板** | 数据驱动优化 | 高 |

---

## 数据驱动优化（产品经理视角）

1. 先抽查确认知识库有无对应内容（排除数据缺失）
2. 按影响面排优先级（反馈量大的先优化）
3. "信息不准确"类反馈是混合型——可能是检索到旧版文档（检索错误），也可能是模型理解偏差（生成错误），需逐条看检索日志

---

## 验证中的错误与纠正

| 错误点 | 纠正 |
|--------|------|
| Case 1 判断路径不严谨：因为"没回答渠道"判定检索错误 | 应该先看检索结果是否与用户意图匹配，而不是只看"有没有给答案" |

---

## 💡 验证高光

**进阶题（反馈数据分析）**：
- 正确提出"先抽查确认知识库有无内容"的优先级判断
- 按反馈量排优化优先级（ROI思维）

**挑战题（诊断SOP）**：
- 判断树逻辑完整，分类结果正确
- 差距在文档输出颗粒度（操作指引、判断标准表格化），非概念理解问题

**元认知自评**：9/10，整体有把握。

---

## 关联概念

- [[A1. RAG流程与架构]] - 检索和生成是RAG流程的两个核心环节
- [[B1. 文档分块策略]] - 分块问题是检索错误的常见根因
- [[P3. 数据质量对RAG的影响]] - 数据缺失是第三种可能性
